<input type="email" id="email" placeholder="Enter your email">
<button onclick="verify()">Verify & Download</button>

<div id="result" style="margin-top:10px;font-weight:bold;"></div>

<script>
const WEBAPP_URL =
  "https://script.google.com/macros/s/AKfycbwKy4rZjMCZaWfbN3QPkMqENRPkxwYwyN4KaRUYPCR6Lftbo6amCynXDkD1cBVWEUM/exec";

function verify() {
  const email = document.getElementById("email").value.trim();
  const result = document.getElementById("result");

  result.innerHTML = "";

  if (!email) {
    result.innerText = "‚ùå Please enter email";
    return;
  }

  result.innerText = "‚è≥ Verifying...";

  fetch(WEBAPP_URL, {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: "email=" + encodeURIComponent(email)
  })
    .then(response => response.text()) // üëà pehle RAW text
    .then(text => {
      console.log("RAW RESPONSE:", text);

      let data;
      try {
        data = JSON.parse(text);
      } catch (e) {
        throw new Error("Invalid JSON from server");
      }

      if (data.status === "success" && data.downloadUrl) {
        result.innerHTML = `
          ‚úÖ Verified<br><br>
          <a href="${data.downloadUrl}" target="_blank" rel="noopener">
            ‚¨á Download Certificate
          </a>
        `;
      } else {
        result.innerText = "‚ùå " + (data.message || "Invalid email");
      }
    })
    .catch(err => {
      console.error(err);
      result.innerText = "‚ùå Server error";
    });
}
</script>
